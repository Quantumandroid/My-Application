<html>
<head>
<title>HighlightArrayAdapter.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: rgb(0,0,0); font-weight: normal; font-style: normal; }
.s0 { color: rgb(0,0,128); font-weight: bold; }
.s1 { color: rgb(0,0,0); }
.s2 { color: rgb(0,0,255); }
.s3 { color: rgb(128,128,128); font-style: italic; }
.s4 { color: rgb(0,128,0); font-weight: bold; }
</style>
</head>
<BODY BGCOLOR="#ffffff">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#C0C0C0" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
HighlightArrayAdapter.java</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">package </span><span class="s1">com.example.shindemandar82.list_fragment; 
 
</span><span class="s0">import </span><span class="s1">android.content.Context; 
</span><span class="s0">import </span><span class="s1">android.content.res.ColorStateList; 
</span><span class="s0">import </span><span class="s1">android.graphics.Color; 
</span><span class="s0">import </span><span class="s1">android.graphics.Typeface; 
</span><span class="s0">import </span><span class="s1">android.text.Spannable; 
</span><span class="s0">import </span><span class="s1">android.text.SpannableString; 
</span><span class="s0">import </span><span class="s1">android.text.style.TextAppearanceSpan; 
</span><span class="s0">import </span><span class="s1">android.util.Log; 
</span><span class="s0">import </span><span class="s1">android.view.LayoutInflater; 
</span><span class="s0">import </span><span class="s1">android.view.View; 
</span><span class="s0">import </span><span class="s1">android.view.ViewGroup; 
</span><span class="s0">import </span><span class="s1">android.widget.ArrayAdapter; 
</span><span class="s0">import </span><span class="s1">android.widget.Filter; 
</span><span class="s0">import </span><span class="s1">android.widget.TextView; 
 
</span><span class="s0">import </span><span class="s1">java.util.ArrayList; 
</span><span class="s0">import </span><span class="s1">java.util.Arrays; 
</span><span class="s0">import </span><span class="s1">java.util.List; 
</span><span class="s0">import </span><span class="s1">java.util.Locale; 
 
 
</span><span class="s0">public class </span><span class="s1">HighlightArrayAdapter </span><span class="s0">extends </span><span class="s1">ArrayAdapter&lt;String&gt; { 
    </span><span class="s0">private final </span><span class="s1">LayoutInflater mInflater; 
    </span><span class="s0">private final </span><span class="s1">Context mContext; 
    </span><span class="s0">private final int </span><span class="s1">mResource; 
    </span><span class="s0">private </span><span class="s1">List&lt;String&gt; mObjects; 
    </span><span class="s0">private int </span><span class="s1">mFieldId = </span><span class="s2">0</span><span class="s1">; 
    </span><span class="s0">private </span><span class="s1">ArrayList&lt;String&gt; mOriginalValues; 
    </span><span class="s0">private </span><span class="s1">ArrayFilter mFilter; 
    </span><span class="s0">private final </span><span class="s1">Object mLock = </span><span class="s0">new </span><span class="s1">Object(); 
    </span><span class="s0">private </span><span class="s1">String mSearchText; </span><span class="s3">// this var for highlight</span><span class="s1"> 
 
    </span><span class="s0">public </span><span class="s1">HighlightArrayAdapter(Context context, </span><span class="s0">int </span><span class="s1">resource, </span><span class="s0">int </span><span class="s1">textViewResourceId, String[] objects) { 
        </span><span class="s0">super</span><span class="s1">(context, resource, textViewResourceId, objects); 
        mContext = context; 
        mInflater = LayoutInflater.from(context); 
        mResource = resource; 
        mObjects = Arrays.asList(objects); 
        mFieldId = textViewResourceId; 
    } 
 
    @Override 
    </span><span class="s0">public </span><span class="s1">Context getContext() { 
        </span><span class="s0">return </span><span class="s1">mContext; 
    } 
 
    @Override 
    </span><span class="s0">public int </span><span class="s1">getCount() { 
        </span><span class="s0">return </span><span class="s1">mObjects.size(); 
    } 
 
    @Override 
    </span><span class="s0">public </span><span class="s1">String getItem(</span><span class="s0">int </span><span class="s1">position) { 
        </span><span class="s0">return </span><span class="s1">mObjects.get(position); 
    } 
 
    @Override 
    </span><span class="s0">public int </span><span class="s1">getPosition(String item) { 
        </span><span class="s0">return </span><span class="s1">mObjects.indexOf(item); 
    } 
 
    @Override 
    </span><span class="s0">public </span><span class="s1">Filter getFilter() { 
        </span><span class="s0">if </span><span class="s1">(mFilter == </span><span class="s0">null</span><span class="s1">) { 
            mFilter = </span><span class="s0">new </span><span class="s1">ArrayFilter(); 
        } 
        </span><span class="s0">return </span><span class="s1">mFilter; 
    } 
 
    </span><span class="s0">private class </span><span class="s1">ArrayFilter </span><span class="s0">extends </span><span class="s1">Filter { 
        @Override 
        </span><span class="s0">protected </span><span class="s1">FilterResults performFiltering(CharSequence prefix) { 
            FilterResults results = </span><span class="s0">new </span><span class="s1">FilterResults(); 
 
            </span><span class="s0">if </span><span class="s1">(mOriginalValues == </span><span class="s0">null</span><span class="s1">) { 
                </span><span class="s0">synchronized </span><span class="s1">(mLock) { 
                    mOriginalValues = </span><span class="s0">new </span><span class="s1">ArrayList&lt;&gt;(mObjects); 
                } 
            } 
 
            </span><span class="s0">if </span><span class="s1">(prefix == </span><span class="s0">null </span><span class="s1">|| prefix.length() == </span><span class="s2">0</span><span class="s1">) { 
                mSearchText = </span><span class="s4">&quot;&quot;</span><span class="s1">; 
                ArrayList&lt;String&gt; list; 
                </span><span class="s0">synchronized </span><span class="s1">(mLock) { 
                    list = </span><span class="s0">new </span><span class="s1">ArrayList&lt;&gt;(mOriginalValues); 
                } 
                results.values = list; 
                results.count = list.size(); 
            } </span><span class="s0">else </span><span class="s1">{ 
                String prefixString = prefix.toString().toLowerCase(); 
                mSearchText = prefixString; 
                ArrayList&lt;String&gt; values; 
                </span><span class="s0">synchronized </span><span class="s1">(mLock) { 
                    values = </span><span class="s0">new </span><span class="s1">ArrayList&lt;&gt;(mOriginalValues); 
                } 
 
                </span><span class="s0">final int </span><span class="s1">count = values.size(); 
                </span><span class="s0">final </span><span class="s1">ArrayList&lt;String&gt; newValues = </span><span class="s0">new </span><span class="s1">ArrayList&lt;&gt;(); 
 
                </span><span class="s0">final </span><span class="s1">String[] searchWords = prefixString.split(</span><span class="s4">&quot; &quot;</span><span class="s1">); 
 
                </span><span class="s0">for </span><span class="s1">(String searchWord : searchWords) { 
                    </span><span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">i = </span><span class="s2">0</span><span class="s1">; i &lt; count; i++) { 
                        </span><span class="s0">final </span><span class="s1">String value = values.get(i); 
                        </span><span class="s0">final </span><span class="s1">String valueText = value.toLowerCase(); 
 
                        </span><span class="s3">// First match against the whole, non-splitted value</span><span class="s1"> 
                        </span><span class="s0">if </span><span class="s1">(valueText.startsWith(searchWord) || valueText.contains(searchWord)) { 
                            newValues.add(value); 
                        } </span><span class="s0">else </span><span class="s1">{ 
                            </span><span class="s0">final </span><span class="s1">String[] words = valueText.split(</span><span class="s4">&quot; &quot;</span><span class="s1">); 
                            </span><span class="s0">for </span><span class="s1">(String word : words) { 
                                </span><span class="s0">if </span><span class="s1">(word.startsWith(searchWord) || word.contains(searchWord)) { 
                                    newValues.add(value); 
                                    </span><span class="s0">break</span><span class="s1">; 
                                } 
                            } 
                        } 
 
                    } 
 
                } 
 
                results.values = newValues; 
                results.count = newValues.size(); 
            } 
 
            </span><span class="s0">return </span><span class="s1">results; 
        } 
 
        @Override 
        </span><span class="s0">protected void </span><span class="s1">publishResults(CharSequence constraint, FilterResults results) { 
            </span><span class="s3">//noinspection unchecked</span><span class="s1"> 
            mObjects = (List&lt;String&gt;) results.values; 
            </span><span class="s0">if </span><span class="s1">(results.count &gt; </span><span class="s2">0</span><span class="s1">) { 
                notifyDataSetChanged(); 
            } </span><span class="s0">else </span><span class="s1">{ 
                notifyDataSetInvalidated(); 
            } 
        } 
    } 
 
    @Override 
    </span><span class="s0">public </span><span class="s1">View getView(</span><span class="s0">int </span><span class="s1">position, View convertView, ViewGroup parent) { 
        View view; 
        TextView text; 
 
        </span><span class="s0">if </span><span class="s1">(convertView == </span><span class="s0">null</span><span class="s1">) { 
            view = mInflater.inflate(mResource, parent, </span><span class="s0">false</span><span class="s1">); 
        } </span><span class="s0">else </span><span class="s1">{ 
            view = convertView; 
        } 
 
        </span><span class="s0">try </span><span class="s1">{ 
            </span><span class="s0">if </span><span class="s1">(mFieldId == </span><span class="s2">0</span><span class="s1">) { 
                </span><span class="s3">//  If no custom field is assigned, assume the whole resource is a TextView</span><span class="s1"> 
                text = (TextView) view; 
            } </span><span class="s0">else </span><span class="s1">{ 
                </span><span class="s3">//  Otherwise, find the TextView field within the layout</span><span class="s1"> 
                text = (TextView) view.findViewById(mFieldId); 
            } 
        } </span><span class="s0">catch </span><span class="s1">(ClassCastException e) { 
            Log.e(</span><span class="s4">&quot;ArrayAdapter&quot;</span><span class="s1">, </span><span class="s4">&quot;You must supply a resource ID for a TextView&quot;</span><span class="s1">); 
            </span><span class="s0">throw new </span><span class="s1">IllegalStateException( 
                    </span><span class="s4">&quot;ArrayAdapter requires the resource ID to be a TextView&quot;</span><span class="s1">, e); 
        } 
 
        </span><span class="s3">// HIGHLIGHT...</span><span class="s1"> 
 
        String fullText = getItem(position); 
        </span><span class="s0">if </span><span class="s1">(mSearchText != </span><span class="s0">null </span><span class="s1">&amp;&amp; !mSearchText.isEmpty()) { 
            Spannable spannable = </span><span class="s0">new </span><span class="s1">SpannableString(fullText); 
            String[] searchWords = mSearchText.split(</span><span class="s4">&quot; &quot;</span><span class="s1">); 
            </span><span class="s0">for </span><span class="s1">(String searchWord : searchWords) { 
                </span><span class="s0">int </span><span class="s1">startPos = fullText.toLowerCase(Locale.US).indexOf(searchWord.toLowerCase(Locale.US)); 
                </span><span class="s0">int </span><span class="s1">endPos = startPos + searchWord.length(); 
 
                </span><span class="s0">if </span><span class="s1">(startPos != -</span><span class="s2">1</span><span class="s1">) { 
                    ColorStateList blueColor = </span><span class="s0">new </span><span class="s1">ColorStateList(</span><span class="s0">new int</span><span class="s1">[][]{</span><span class="s0">new int</span><span class="s1">[]{}}, </span><span class="s0">new int</span><span class="s1">[]{Color.BLUE}); 
                    TextAppearanceSpan highlightSpan = </span><span class="s0">new </span><span class="s1">TextAppearanceSpan(</span><span class="s0">null</span><span class="s1">, Typeface.BOLD, -</span><span class="s2">1</span><span class="s1">, blueColor, </span><span class="s0">null</span><span class="s1">); 
                    spannable.setSpan(highlightSpan, startPos, endPos, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE); 
                } 
            } 
            text.setText(spannable); 
        } </span><span class="s0">else </span><span class="s1">{ 
            text.setText(fullText); 
        } 
 
        </span><span class="s0">return </span><span class="s1">view; 
    } 
}</span></pre>
</body>
</html>